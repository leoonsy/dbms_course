$(function(){var t,e="core/api.php",a=($.ajax({url:"core/api.php?acl",method:"get",dataType:"json",async:!1,success:function(e){t=e}}),t),s=y(),r={categories:[{index:"id",title:"ID",type:"number",locked:!0,width:50,editable:!1},{index:"name",title:"Имя",type:"string",width:200}],products:[{index:"id",title:"ID",type:"number",locked:!0,width:50,editable:!1},{index:"category_id",title:"Категория",type:"combo",data:m("categories"),width:150},{index:"name",title:"Имя",type:"string",width:200},{index:"price",title:"Цена",type:"number",width:80},{index:"count",title:"Количество",type:"string",width:90}],orders:[{index:"id",title:"ID",type:"number",locked:!0,width:50,editable:!1},{index:"customer_id",title:"Покупатель",type:"combo",data:m("customers"),width:140},{index:"product_id",title:"Товар",type:"combo",data:m("products"),width:160},{index:"product_count",title:"Количество товаров",type:"number",width:150},{index:"price",title:"Цена",type:"number",width:80}],customers:[{index:"id",title:"ID",type:"number",locked:!0,width:50,editable:!1},{index:"first_name",title:"Имя",type:"string"},{index:"last_name",title:"Фамилия",type:"string"}]},i={type:"string",width:150,resizable:!0,sortable:!0,editable:a.update},n=[{key:"insert",text:"Добавить",action:"add"},{key:"delete",text:"Удалить",action:"remove",tip:"Выделите строки для удаления"},{key:"search",type:"search",width:350,emptyText:"Поиск",paramsMenu:!0,paramsText:"Параметры"}];n=n.filter(function(e,t,r){return!(!1===a[e.key])});var o=JSON.parse(JSON.stringify(n)),d=JSON.parse(JSON.stringify(n)),l=JSON.parse(JSON.stringify(n)),u={pageSize:20,pageSizeData:[5,10,20,50,100,500,1e3]},c="ru",p=new FancyTab({resizable:!1,renderTo:"mainTable",title:"База данных компьютерного магазина",height:650,trackOver:!0,items:[{title:"Категории",selModel:"rows",type:"grid",data:{proxy:{type:"rest",url:"".concat(e,"?table=categories"),afterRequest:h,beforeRequest:v}},defaults:i,columns:r.categories,tbar:n,clicksToEdit:2,paging:u,i18n:c},{title:"Продукты",selModel:"rows",type:"grid",data:{proxy:{type:"rest",url:"".concat(e,"?table=products"),afterRequest:h,beforeRequest:v}},defaults:i,columns:r.products,tbar:o,clicksToEdit:2,paging:u,i18n:c},{title:"Заказы",selModel:"rows",type:"grid",data:{proxy:{type:"rest",url:"".concat(e,"?table=orders"),afterRequest:h,beforeRequest:v}},defaults:i,columns:r.orders,tbar:d,clicksToEdit:2,paging:u,i18n:c},{title:"Покупатели",selModel:"rows",type:"grid",data:{proxy:{type:"rest",url:"".concat(e,"?table=customers"),afterRequest:h,beforeRequest:v}},defaults:i,columns:r.customers,tbar:l,clicksToEdit:2,paging:u,i18n:c}]});function y(){var t;return $.ajax({url:"core/api.php?reference",method:"get",dataType:"json",async:!1,success:function(e){t=e}}),t}function m(e){var t=[],r=!0,a=!1,i=void 0;try{for(var n,o=s[e][Symbol.iterator]();!(r=(n=o.next()).done);r=!0){var d=n.value;t.push(d.name)}}catch(e){a=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(a)throw i}}return t}function f(e,t){var r=!0,a=!1,i=void 0;try{for(var n,o=s[t][Symbol.iterator]();!(r=(n=o.next()).done);r=!0){var d=n.value;if(d.id==e)return d.name}}catch(e){a=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(a)throw i}}return null}function b(e,t){var r=!0,a=!1,i=void 0;try{for(var n,o=s[t][Symbol.iterator]();!(r=(n=o.next()).done);r=!0){var d=n.value;if(d.name==e)return d.id}}catch(e){a=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(a)throw i}}return null}function g(e){e.customer_id&&(e.customer_id=f(e.customer_id,"customers")),e.product_id&&(e.product_id=f(e.product_id,"products")),e.category_id&&(e.category_id=f(e.category_id,"categories"))}function h(e){if("read"!=e.type&&(s=y()),e.response.data)if(Array.isArray(e.response.data)){var t=!0,r=!1,a=void 0;try{for(var i,n=e.response.data[Symbol.iterator]();!(t=(i=n.next()).done);t=!0){g(i.value)}}catch(e){r=!0,a=e}finally{try{t||null==n.return||n.return()}finally{if(r)throw a}}}else g(e.response.data);if("destroy"==e.type||"update"==e.type){var o=p.activeTab;if(0!=o&&3!=o)return e;for(var d=0;d<p.items.length;d++)d!=o&&null!=p.items[d].load&&p.items[d].load()}return e}function v(e){switch(e.params.key){case"customer_id":e.params.value=b(e.params.value,"customers");break;case"product_id":e.params.value=b(e.params.value,"products");break;case"category_id":e.params.value=b(e.params.value,"categories")}return e}});
//# sourceMappingURL=main.min.js.map
